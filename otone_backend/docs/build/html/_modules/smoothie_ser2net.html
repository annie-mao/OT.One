<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>smoothie_ser2net &mdash; OT.One 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="OT.One 1.0.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">OT.One 1.0.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for smoothie_ser2net</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">asyncio</span><span class="o">,</span> <span class="nn">json</span> 
<span class="kn">from</span> <span class="nn">file_io</span> <span class="kn">import</span> <span class="n">FileIO</span>
<span class="kn">import</span> <span class="nn">script_keeper</span> <span class="kn">as</span> <span class="nn">sk</span>

<span class="n">debug</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">io_debug</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">verbose</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="Smoothie"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie">[docs]</a><span class="k">class</span> <span class="nc">Smoothie</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Smoothie class </span>

<span class="sd">    The Smoothie class is instantiated into a smoothie object</span>
<span class="sd">    to communicate with the smoothieboard. A &quot;nested&quot; asyncio.Protocol subclass, CB_Factory, </span>
<span class="sd">    is used with asyncio&#39;s create_connection function to create a streaming transport </span>
<span class="sd">    connection to host and port 0.0.0.0:3333, which in turn is connected to the smoothieboard</span>
<span class="sd">    via ser2net. CB_Factory contains three callbacks:</span>

<span class="sd">    - connection_made</span>
<span class="sd">    - data_received</span>
<span class="sd">    - connection_lost</span>


<span class="sd">    CB_Factory Callbacks:</span>

<span class="sd">    - connection_made     causes the machine to home and is not currently set to call an external </span>
<span class="sd">    callback</span>

<span class="sd">    - data_receieved      parses data receieved into command lines and calls the smoothie_handler </span>
<span class="sd">    function for each command line and that in turn calls the on_raw_data and on_state_change external</span>
<span class="sd">    callbacks</span>

<span class="sd">    - connection_lost     is not currently set to an external callback</span>

<span class="sd">    </span>
<span class="sd">    External Callbacks:</span>

<span class="sd">    - on_raw_data</span>

<span class="sd">    - on_state_change</span>

<span class="sd">    - on_limit_hit</span>

<span class="sd">    The smoothie object also contains an index of smoothieboard commands in the form of a </span>
<span class="sd">    dictionary object called _dict, and a dictionary object called theState to hold information about the state</span>
<span class="sd">    of the robot.</span>

<span class="sd">    :todo:</span>
<span class="sd">    1. Show an example coords_list in documentation (:meth:`move`)</span>
<span class="sd">    2. (see also below)</span>

<span class="sd">    :See also:</span>
<span class="sd">    :download:`../../backend/OTONE_DATAFLOW.pdf`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;absoluteMove&#39;</span> <span class="p">:</span> <span class="s">&quot;G90</span><span class="se">\r\n</span><span class="s">G0&quot;</span><span class="p">,</span>
        <span class="s">&#39;relativeMove&#39;</span> <span class="p">:</span> <span class="s">&quot;G91</span><span class="se">\r\n</span><span class="s">G0&quot;</span><span class="p">,</span>
        <span class="s">&#39;home&#39;</span> <span class="p">:</span> <span class="s">&quot;G28&quot;</span><span class="p">,</span>
        <span class="s">&#39;setupFeedback&#39;</span> <span class="p">:</span> <span class="s">&quot;M62&quot;</span><span class="p">,</span>
        <span class="s">&#39;off&#39;</span> <span class="p">:</span> <span class="s">&quot;M112&quot;</span><span class="p">,</span>
        <span class="s">&#39;on&#39;</span> <span class="p">:</span> <span class="s">&quot;M999&quot;</span><span class="p">,</span>
        <span class="s">&#39;speed_xyz&#39;</span> <span class="p">:</span> <span class="s">&quot;G0F&quot;</span><span class="p">,</span>
        <span class="s">&#39;speed_a&#39;</span> <span class="p">:</span> <span class="s">&quot;G0a&quot;</span><span class="p">,</span>
        <span class="s">&#39;speed_b&#39;</span> <span class="p">:</span> <span class="s">&quot;G0b&quot;</span><span class="p">,</span>
        <span class="s">&#39;speed_c&#39;</span> <span class="p">:</span> <span class="s">&quot;G0c&quot;</span><span class="p">,</span>
        <span class="s">&#39;reset&#39;</span> <span class="p">:</span> <span class="s">&#39;reset&#39;</span>
    <span class="p">}</span>

    <span class="n">theState</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&#39;y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&#39;b&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&#39;stat&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">&#39;delaying&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&#39;homing&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s">&#39;y&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s">&#39;b&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">old_msg</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_transport</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_callback</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit_hit_callback</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_callback</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smoothieQueue</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">already_trying</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ack_msg_rcvd</span> <span class="o">=</span> <span class="s">&quot;ok&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_ready</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="Smoothie.CB_Factory"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.CB_Factory">[docs]</a>    <span class="k">class</span> <span class="nc">CB_Factory</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Protocol</span><span class="p">):</span>
        <span class="n">proc_data</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">old_data</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">CB_Factory.__init__ called&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>
        
<div class="viewcode-block" id="Smoothie.CB_Factory.connection_made"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.CB_Factory.connection_made">[docs]</a>        <span class="k">def</span> <span class="nf">connection_made</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transport</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Callback when a connection is made</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">CB_Factory.connection_made called&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="n">transport</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">my_transport</span> <span class="o">=</span> <span class="n">transport</span>
            <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
            <span class="n">loop</span><span class="o">.</span><span class="n">call_later</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">on_success_connecting</span><span class="p">)</span><span class="c">#, self.outer)</span>

</div>
<div class="viewcode-block" id="Smoothie.CB_Factory.data_received"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.CB_Factory.data_received">[docs]</a>        <span class="k">def</span> <span class="nf">data_received</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Callback when data is received from Smoothieboard</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">debug</span><span class="o">==</span><span class="bp">True</span> <span class="ow">or</span> <span class="n">io_debug</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_data</span> <span class="o">!=</span> <span class="n">data</span><span class="p">:</span>            
                    <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">CBFactory.data_received: &#39;</span><span class="o">+</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">old_data</span> <span class="o">=</span> <span class="n">data</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">proc_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_data</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="n">deli</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">sub_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_data</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">proc_data</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proc_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">proc_data</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">list_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">+</span><span class="n">deli</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">sub_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">deli</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">list_data</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">smoothie_handler</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>  <span class="c">#self.outer</span>
            
</div>
<div class="viewcode-block" id="Smoothie.CB_Factory.connection_lost"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.CB_Factory.connection_lost">[docs]</a>        <span class="k">def</span> <span class="nf">connection_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Callback when connection is lost</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">CBFactory.connection_lost called&quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">my_transport</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">proc_data</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">on_disconnect</span><span class="p">()</span><span class="c">#self.outer)</span>
</div></div>
<div class="viewcode-block" id="Smoothie.set_raw_callback"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.set_raw_callback">[docs]</a>    <span class="k">def</span> <span class="nf">set_raw_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;connects the external callback for raw data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.set_raw_callback called&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_callback</span> <span class="o">=</span> <span class="n">callback</span>
</div>
<div class="viewcode-block" id="Smoothie.set_limit_hit_callback"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.set_limit_hit_callback">[docs]</a>    <span class="k">def</span> <span class="nf">set_limit_hit_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Connect the external callback for limit hit data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.set_limit_hit_callback called&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit_hit_callback</span> <span class="o">=</span> <span class="n">callback</span>
</div>
<div class="viewcode-block" id="Smoothie.set_move_callback"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.set_move_callback">[docs]</a>    <span class="k">def</span> <span class="nf">set_move_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Connect the external callback for move call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.set_move_callback called&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_callback</span> <span class="o">=</span> <span class="n">callback</span>
</div>
<div class="viewcode-block" id="Smoothie.connect"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make a connection to Smoothieboard using :class:`CB_Factory`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.connect called&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
        <span class="n">callbacker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CB_Factory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">async</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">my_loop</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">callbacker</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">3333</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Smoothie.on_success_connecting"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.on_success_connecting">[docs]</a>    <span class="k">def</span> <span class="nf">on_success_connecting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Smoothie callback for when a connection is made</span>

<span class="sd">        Sends startup commands to engage automatic feedback from Smoothieboard, :meth:`home`, </span>
<span class="sd">        and call :meth:`on_connect` callback</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.on_success_connecting called&#39;</span><span class="p">)</span>
        <span class="c">#print(type(self._dict[&#39;setupFeedback&#39;]))</span>
        <span class="n">thestring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s">&#39;setupFeedback&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">thestring</span><span class="p">)</span>
        <span class="c">#self.try_add(thestring)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">thestring</span><span class="p">)</span><span class="c">#self  self._dict[&#39;setupFeedback&#39;])</span>
        <span class="c">#if debug!=True:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">(</span><span class="nb">dict</span><span class="p">())</span>
        <span class="n">sk</span><span class="o">.</span><span class="n">write_led</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="c">#sk.set_connection_status(99)</span>
            <span class="c">#pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">)</span> <span class="c">#self</span>

</div>
<div class="viewcode-block" id="Smoothie.send"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.send">[docs]</a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sends data to the smoothieboard using a transport</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.send called&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\t</span><span class="s">string: &#39;</span><span class="p">,</span><span class="n">string</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_raw_data</span><span class="p">(</span><span class="s">&#39;--&gt; &#39;</span><span class="o">+</span><span class="n">string</span><span class="p">)</span>  <span class="c">#self</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_transport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">strong</span> <span class="o">=</span> <span class="n">string</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">strong</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="Smoothie.smoothie_handler"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.smoothie_handler">[docs]</a>    <span class="k">def</span> <span class="nf">smoothie_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">data_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle lines of data from Smoothieboard</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ok_print</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_msg</span> <span class="o">!=</span> <span class="n">msg</span><span class="p">:</span>
                <span class="n">ok_print</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.smoothie_handler called&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\t</span><span class="s">msg: &#39;</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_raw_data</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>   <span class="c">#self</span>

        <span class="c">#print(&#39;msg type: &#39;,type(msg))</span>
        <span class="c">#print(&#39;msg.find?: &#39;,msg.find(&#39;{&#39;))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ack_msg_rcvd</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">already_trying</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;ok... self.already_trying: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">already_trying</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;{&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;{&#39;</span><span class="p">):]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;json.loads(msg) error:</span><span class="se">\n\n</span><span class="s">msg is...</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">original message was...</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">data_</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">didStateChange</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">stillHoming</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">ok_print</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net(1):</span><span class="se">\n\t</span><span class="s">theState: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&quot;!!&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">already_trying</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">try_step</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ok_print</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">theState[&#39;</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="s">&#39;] = &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;stat&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">didStateChange</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">already_trying</span> <span class="o">=</span> <span class="bp">False</span>

                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">if</span> <span class="n">ok_print</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                        <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">key:   &#39;</span><span class="p">,</span><span class="n">key</span><span class="p">)</span>
                        <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">value: &#39;</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="c">#print(&#39;homing[key]: &#39;,self.theState[&#39;homing&#39;][key])</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">!=</span><span class="s">&#39;stat&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s">&#39;homing&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s">&#39;delaying&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;homing&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">changing key [&#39;</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="s">&#39;] homing to False&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;homing&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">for</span> <span class="n">h_key</span><span class="p">,</span> <span class="n">h_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;homing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">h_value</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                                <span class="n">stillHoming</span> <span class="o">=</span> <span class="bp">True</span>

                        <span class="k">if</span> <span class="n">stillHoming</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                            <span class="n">didStateChange</span> <span class="o">=</span> <span class="bp">True</span>

                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;limit&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">on_limit_hit</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">didStateChange</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;stat&#39;</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">state_ready</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">already_trying</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smoothieQueue</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">try_step</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">didStateChange</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">on_state_change</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">)</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">prevMsg</span> <span class="o">=</span> <span class="n">msg</span>
            <span class="k">if</span> <span class="n">ok_print</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">didStateChange?: &#39;</span><span class="p">,</span><span class="n">didStateChange</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Smoothie.get_state"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.get_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the robot state</span>

<span class="sd">        example state:</span>

<span class="sd">        theState = {</span>
<span class="sd">        &#39;x&#39;: 0,</span>
<span class="sd">        &#39;y&#39;: 0,</span>
<span class="sd">        &#39;z&#39;: 0,</span>
<span class="sd">        &#39;a&#39;: 0,</span>
<span class="sd">        &#39;b&#39;: 0,</span>
<span class="sd">        &#39;c&#39;: 0,</span>
<span class="sd">        &#39;stat&#39;: 1,</span>
<span class="sd">        &#39;delaying&#39;: 0,</span>
<span class="sd">        &#39;homing&#39;: {</span>
<span class="sd">            &#39;x&#39;: False,</span>
<span class="sd">            &#39;y&#39;: False,</span>
<span class="sd">            &#39;z&#39;: False,</span>
<span class="sd">            &#39;a&#39;: False,</span>
<span class="sd">            &#39;b&#39;: False,</span>
<span class="sd">            &#39;c&#39;: False</span>
<span class="sd">            }</span>
<span class="sd">        }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.get_state called&#39;</span><span class="p">)</span>
        <span class="n">temp_state</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp_state</span>

</div>
<div class="viewcode-block" id="Smoothie.try_add"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.try_add">[docs]</a>    <span class="k">def</span> <span class="nf">try_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a command to the smoothieQueue</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.try_add called&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smoothieQueue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="c">#if len(self.smoothieQueue) == 1:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">try_step</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Smoothie.move"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.move">[docs]</a>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move according to coords_list</span>

<span class="sd">        :todo:</span>
<span class="sd">        1. Show an example coords_list in documentation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> 
            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.move called&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">coords_list: &#39;</span><span class="p">,</span><span class="n">coords_list</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="n">absolMov</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords_list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s">&#39;absoluteMove&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;relative&#39;</span> <span class="ow">in</span> <span class="n">coords_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">coords_list</span><span class="p">[</span><span class="s">&#39;relative&#39;</span><span class="p">]</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                    <span class="n">absolMov</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s">&#39;relativeMove&#39;</span><span class="p">]</span>
        
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">header</span>

            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">coords_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">n:     &#39;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
                    <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">value: &#39;</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">value type: &#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;X&#39;</span> <span class="ow">or</span> <span class="n">n</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;Y&#39;</span> <span class="ow">or</span> <span class="n">n</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;Z&#39;</span> <span class="ow">or</span> <span class="n">n</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;A&#39;</span> <span class="ow">or</span> <span class="n">n</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;B&#39;</span><span class="p">:</span>
                    <span class="n">axis</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="n">axis</span>

                    <span class="k">if</span> <span class="n">absolMov</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">pass</span>

                    <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">cmd: &#39;</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net:</span><span class="se">\n\t</span><span class="s">my_transport not none? &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">my_transport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">try_add</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            
<span class="c">#            if self.my_transport is not None:</span>
<span class="c">#                self.move_callback()</span>
<span class="c">#                self.send(cmd)</span>

</div>
<div class="viewcode-block" id="Smoothie.try_step"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.try_step">[docs]</a>    <span class="k">def</span> <span class="nf">try_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Try to step the smoothieQueue</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> 
            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.try_step called&#39;</span><span class="p">)</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;self.already_trying: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">already_trying</span><span class="p">)</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;self.theState[&#39;stat&#39;]: &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;stat&#39;</span><span class="p">])</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;self.theState[&#39;delaying&#39;]: &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;delaying&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;stat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;delaying&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">already_trying</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">already_trying</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothieQueue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        

</div>
<div class="viewcode-block" id="Smoothie.delay"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.delay">[docs]</a>    <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">milli_seconds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delay for given number of milli_seconds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.delay called&#39;</span><span class="p">)</span>
        <span class="n">float_milli_seconds</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">milli_seconds</span><span class="p">)</span>    
        <span class="k">if</span> <span class="n">float_milli_seconds</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_loop</span><span class="o">.</span><span class="n">call_later</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">milli_seconds</span><span class="p">)</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_state</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;delaying&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_state_change</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Smoothie.delay_state"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.delay_state">[docs]</a>    <span class="k">def</span> <span class="nf">delay_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets theState object&#39;s delaying value to 0, and then calls :meth:`on_state_change`.</span>
<span class="sd">        Used by :meth:`delay` for timing end of a delay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.delay_state called&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;delaying&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_state_change</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Smoothie.home"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.home">[docs]</a>    <span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Home robots according to axis_dict argument</span>

<span class="sd">        If axis_dict is empty, homes all in the order ABZ, XY, to clear the deck before moving in XY plane</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#axis_dict = json.loads(axisJSON)</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.home called&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\t</span><span class="s">axis_dict: &#39;</span><span class="p">,</span> <span class="n">axis_dict</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis_dict</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">axis_dict</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">axis_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">halt</span><span class="p">()</span> <span class="c">#self</span>
        
        <span class="n">homeCommand</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">homingX</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">homingABZ</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="k">if</span> <span class="s">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">axis_dict</span> <span class="ow">or</span> <span class="s">&#39;A&#39;</span> <span class="ow">in</span> <span class="n">axis_dict</span><span class="p">:</span>
            <span class="n">homeCommand</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">]</span>
            <span class="n">homeCommand</span> <span class="o">+=</span> <span class="s">&#39;A&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;homing&#39;</span><span class="p">][</span><span class="s">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">homingABZ</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="s">&#39;b&#39;</span> <span class="ow">in</span> <span class="n">axis_dict</span> <span class="ow">or</span> <span class="s">&#39;B&#39;</span> <span class="ow">in</span> <span class="n">axis_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">homingABZ</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">homeCommand</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">]</span>
            <span class="n">homeCommand</span> <span class="o">+=</span> <span class="s">&#39;B&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;homing&#39;</span><span class="p">][</span><span class="s">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">homingABZ</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="s">&#39;z&#39;</span> <span class="ow">in</span> <span class="n">axis_dict</span> <span class="ow">or</span> <span class="s">&#39;Z&#39;</span> <span class="ow">in</span> <span class="n">axis_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">homingABZ</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">homeCommand</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">]</span>
            <span class="n">homeCommand</span> <span class="o">+=</span> <span class="s">&#39;Z&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;homing&#39;</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">homingABZ</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">homingABZ</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">homeCommand</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">try_add</span><span class="p">(</span><span class="n">homeCommand</span><span class="p">)</span>
            <span class="n">homeCommand</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="k">if</span> <span class="s">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">axis_dict</span> <span class="ow">or</span> <span class="s">&#39;X&#39;</span> <span class="ow">in</span> <span class="n">axis_dict</span><span class="p">:</span>
            <span class="n">homeCommand</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">]</span>
            <span class="n">homeCommand</span> <span class="o">+=</span> <span class="s">&#39;X&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;homing&#39;</span><span class="p">][</span><span class="s">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">homingX</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="s">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">axis_dict</span> <span class="ow">or</span> <span class="s">&#39;Y&#39;</span> <span class="ow">in</span> <span class="n">axis_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">homingX</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">homeCommand</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">]</span>
            <span class="n">homeCommand</span> <span class="o">+=</span> <span class="s">&#39;Y&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theState</span><span class="p">[</span><span class="s">&#39;homing&#39;</span><span class="p">][</span><span class="s">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">homeCommand</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">homeCommand</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">try_add</span><span class="p">(</span><span class="n">homeCommand</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Smoothie.halt"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.halt">[docs]</a>    <span class="k">def</span> <span class="nf">halt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Halt robot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.halt called&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_transport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">#onOffString = self._dict[&#39;off&#39;] + &#39;\r\n&#39; + self._dict[&#39;on&#39;]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">try_add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s">&#39;off&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">try_add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s">&#39;on&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="c">#self.send(onOffString)    #self</span>

</div>
<div class="viewcode-block" id="Smoothie.reset"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset robot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.reset called&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_transport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">resetString</span> <span class="o">=</span> <span class="n">_dict</span><span class="p">[</span><span class="s">&#39;reset&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resetString</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Smoothie.set_speed"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.set_speed">[docs]</a>    <span class="k">def</span> <span class="nf">set_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the speed for a given axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.set_speed called&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\t</span><span class="s">axis: &#39;</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n\t</span><span class="s">value: &#39;</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_transport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="s">&#39;xyz&#39;</span> <span class="ow">or</span> <span class="n">axis</span><span class="o">==</span><span class="s">&#39;a&#39;</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">==</span> <span class="s">&#39;b&#39;</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">==</span> <span class="s">&#39;c&#39;</span><span class="p">:</span>
                    <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s">&#39;speed_&#39;</span><span class="o">+</span><span class="n">axis</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">try_add</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
                    <span class="c">#self.send(string)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.set_speed: axis??? &#39;</span><span class="o">+</span><span class="n">axis</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net: value is not a number???&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net: my_transport is None&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Smoothie.raw"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.raw">[docs]</a>    <span class="k">def</span> <span class="nf">raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send a raw command to the Smoothieboard</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_transport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">#self.try_add(string)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>


    <span class="c">#############################################</span>
    <span class="c">#</span>
    <span class="c">#   CALLBACKS</span>
    <span class="c">#</span>
    <span class="c">#############################################</span>

    <span class="c"># FIRST SET EXTERNAL CALLBACKS</span>

    <span class="c">#def set_on_disconnect_cb(self, od_cb):</span>
    <span class="c">#    self.od_cb = od_cb</span>

    <span class="c">#def set_on_ctate_change_cb(self, osc_cb):</span>
    <span class="c">#    self.osc_cb = osc_cb</span>
    <span class="c"># The callback &#39;hooks&#39;</span>

</div>
<div class="viewcode-block" id="Smoothie.on_connect"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.on_connect">[docs]</a>    <span class="k">def</span> <span class="nf">on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theState</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback when connection made</span>

<span class="sd">        currently does zilch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.on_connect called&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@asyncio.coroutine</span>
<div class="viewcode-block" id="Smoothie.on_disconnect"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.on_disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">on_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback when disconnected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.on_disconnect called&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;error trying to connect&#39;</span><span class="p">)</span>
        <span class="c">#if hasattr(self.od_cb, &#39;__call__&#39;):</span>
        <span class="c">#    self.od_cb()</span>
</div>
<div class="viewcode-block" id="Smoothie.on_raw_data"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.on_raw_data">[docs]</a>    <span class="k">def</span> <span class="nf">on_raw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calls an external callback to show raw data lines received</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_msg</span> <span class="o">!=</span> <span class="n">msg</span> <span class="ow">and</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.on_raw_data called&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">old_msg</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_callback</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_callback</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
</div>
<div class="viewcode-block" id="Smoothie.on_state_change"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.on_state_change">[docs]</a>    <span class="k">def</span> <span class="nf">on_state_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calls an external callback for when theState changes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.on_state_change called&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n\t</span><span class="s">state:</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="p">,</span><span class="s">&#39;on_state_change&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">on_state_change</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.on_state_change: problem calling self.outer.on_state_change&#39;</span><span class="p">)</span>
                <span class="k">raise</span>
</div>
<div class="viewcode-block" id="Smoothie.on_limit_hit"><a class="viewcode-back" href="../smoothie_ser2net.html#smoothie_ser2net.Smoothie.on_limit_hit">[docs]</a>    <span class="k">def</span> <span class="nf">on_limit_hit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calls an external callback for when a limitswitch is hit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;smoothie_ser2net.on_limit_hit called&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n\t</span><span class="s">axis:</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit_hit_callback</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">limit_hit_callback</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">smooth</span> <span class="o">=</span> <span class="n">Smoothie</span><span class="p">()</span>
    <span class="n">smooth</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Nick Wagner.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.4</a>
      
    </div>

    

    
  </body>
</html>